package net.daum.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import jakarta.servlet.http.HttpServletRequest;
import net.daum.service.BoardService;
import net.daum.vo.BoardVO;

@Controller
@RequestMapping("/board/*") //컨트롤러 자체 매핑주소 등록
public class BoardController {

	@Autowired
	private BoardService boardService;
	
	//게시판 글쓰기 폼
	@RequestMapping(value="/board_write",method=RequestMethod.GET) //get으로 접근하는 매핑주소 처리, board_write매핑주소 등록
	public void board_write() {
		//리턴타입이 없는 void형이면 매핑주소가 뷰페이지 파일명이 된다. 뷰페이지 경로는 /WEB-INF/views/board/board_write.jsp
	}//board_write()
	
	//게시판 저장
	@PostMapping("/board_write_ok") //POST로 접근하는 매핑주소를 처리
    public String board_write_ok(BoardVO b) {
		/* board_write.jsp의 네임피라미터 이름과 BoardVO.java의 변수명이 같으면 BoardVO b객체에 글쓴이,글제목,글내용 값이 저장되어 있다. 
		 */
		this.boardService.insertBoard(b);//게시판 저장
		return "redirect:/board/board_list";//게시판 목록보기 매핑주소로 이동
	}//board_write_ok()
	
	//게시판 목록
	@GetMapping("/board_list")
	public ModelAndView board_list(BoardVO b,HttpServletRequest request) {
		int page = 1;//현재쪽번호
		int limit = 7;//한페이지에 보여지는 목록개수
		
		if(request.getParameter("page") != null) {
			page = Integer.parseInt(request.getParameter("page"));//쪽번호를 정수 숫자로 변경해서 저장
		}
		b.setStartrow((page-1)*7+1);//시작행번호
		b.setEndrow(b.getStartrow()+limit-1);//끝행번호
		
		int totalCount = this.boardService.getTotalCount();//총게시물 수
		
		List<BoardVO> blist = this.boardService.getBoardList(b);//게시판 목록
		
		/*페이징 연산*/
		int maxpage = (int)((double)totalCount/limit+0.95);//총페이지수
		int startpage = (((int)((double)page/10+0.9))-1)*10+1;//현재페이지에 보여질 시작페이지
		int endpage = maxpage;//현재 페이지에 보여질 마지막 페이지
		
		if(endpage > startpage+10-1) endpage=startpage+10-1;
		
		ModelAndView listM=new ModelAndView("board/board_list");//생성자 인자값으로 뷰페이지 경로 설정
		listM.addObject("totalCount", totalCount);//totalCount키이름에 총게시물 수 저장
		listM.addObject("blist", blist);//blist키이름에 목록을 저장
		listM.addObject("page", page);
		listM.addObject("maxpage", maxpage);
		listM.addObject("startpage", startpage);
		listM.addObject("endpage", endpage);
		
		return listM;
	}//board_list()
}









