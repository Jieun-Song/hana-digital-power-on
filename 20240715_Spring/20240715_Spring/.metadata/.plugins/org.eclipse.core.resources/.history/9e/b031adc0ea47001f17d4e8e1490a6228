<%@ page contentType="text/html; charset=UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>스프링 mvc게시판 내용보기 </title>
</head>
<body>
	<table border = "1">
		<tr>
			<th colspan = "2">스프링MVC게시판 내용보기</th>	
		</tr>	
		<tr>
			<th>제목</th>
			<td>${bc.title}</td>
		</tr>
		<tr>
			<th>내용</th> <td>${bc.content}</td>
		</tr>
		<tr>
			<th>조회</th> <td>${bc.viewcnt}</td>
		</tr>
		<tr>
			<th colspan="2">
				<input type="button" value="수정" onclick="location='/board/board_cont?bno=${bc.bno}&page=${page}&state=edit';">
				<input type="button" value="삭제" onclick="location='/board/board_del?bno=${bc.bno}&page=${page}';">
				<input type="button" value="목록" onclick="location='/board/board_list?page=${page}';">					
			</th>
		</tr>
	</table>
	
	
	<script type="text/javascript">
   $bno = ${bc.bno};//게시판 번호, $bno는 jQuery변수명
   
   getAllList();//댓글목록 함수
   function getAllList(){
      $.getJSON("/replies/all/"+$bno, function(data){
         $str="";
         $(data).each(function(){//each() jQuery함수는 댓글목록을 반복한다.
            $str += "<li data-rno='"+this.rno+"' class='replyLi'>"
            + this.rno +" : <span class='com' style='color:blue;font-weight:bold;'>"+this.replytext+"</span>"
            + " <button>댓글수정</button></li><br/>";
         });
         $('#replies').html($str);//jQuery html()함수로 문자와 태그를 함께 변경적용
      });      
   }//getAllList()
   
   //댓글 추가
   $('#replyAddBtn').on('click', function(){
		$replyer = $('#newReplyWriter').val(); // 댓글작성자
		$replytext = $('#newReplyText').val(); //댓글내용 
		
		$.ajax({
		 	type:'post', // 메서드 전송방법 
		 	url : "/replies/addReply", //아작스 서버매핑주소
		  	headers : {
				"Content-Type" : "application/json",
				"X-HTTP-Method-Override" : "POST"
			},
			dataType : 'text',
			data:JSON.stringify({
				bno:$bno,
				replyer:$replyer,
				replytext:$replytext
			}),		
			success : function(data){
				if(data == 'SUCCESS'){
					alert('댓글이 등록되었습니다!');
					getAllList();
				}
			}
   		});
   });
   
   
   //댓글 수정화면
   $('#replies').on('click', '.replyLi button', function(){
	  var reply = $(this).parent();//button태그의 부모요소 parent()는 li태그이다.
	  var rno = reply.attr('data-rno');//date -rno속성값 댓글번호를 가져옴 .
	  var replytext = reply.children('.com').text();//댓글내용
	  
	  $('.modal-title').html(rno);//댓글번호를 표시
	  $('#replytext').val(replytext);//댓글 내용을 textarea입력박스에 표시
	  $('#modDiv').show('slow');//댓글수정화면을 천천히 보이게 하기 
   });
   
   //댓글 수정 화면 닫기
   function modDivClose(){
	  $('#modDiv').hide('slow');//댓글 수정화면을 천천히 닫기
   }
   
   //댓글 수정 완료
   $("#replyModBtn").on("click", function(){
		$rno = $('.modal-title').html();//댓글번호
		$replytext = $('#replytext').val();//수정한 댓글내용
		
		$.ajax({
			type:'put',
			url:'/replies/editReply/' + $rno,
			headers : {
				"Content-Type":"application/json",
				"X-HTTP-Method-Override" : "PUT"
			},
			data : JSON.stringify({
				replytext : $replytext
			}),
			dataType : 'text',
			success : function(result){
				if(result == 'SUCCESS'){
					alert('댓글이 수정되었습니다!');
					$('#modeDiv').hide('slow');//댓글 수정화면 닫기
					getAllList();//댓글목록 함수호
				}
			}
		});
   });		
   
   $("#replyDelBtn").on("click", function(){
		var rno = $('.modal-title').html();//댓글번호
		
		$.ajax({
			type:'delete',
			url:'/replies/delReply/'+rno,
			headers : {
				"Content-Type" : "application/json",
				"X-HTTP-Method-Override" : "DELETE"
			},
			dataType : 'text',
			success : function(result){
				if(result == 'SUCCESS'){
					alert('댓글이 삭제되었습니다!');
					$('#modDiv').hide('slow');
					getAllList();
				}	
			}
		});
   });
 </script>
	
</body>
</html>






